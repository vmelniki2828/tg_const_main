#!/bin/bash

echo "üîç –û—Ç–ª–∞–¥–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–≤–∏–∑–æ–≤..."

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã..."
docker-compose -f docker-compose.yml down

# –°–æ–∑–¥–∞—Ç—å –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
echo "üìä –°–æ–∑–¥–∞–µ–º –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏..."
echo '{}' > backend/quizStats.json
chmod 666 backend/quizStats.json

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
echo "üî® –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º..."
docker-compose -f docker-compose.yml up --build -d

# –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ
echo "‚è≥ –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞..."
sleep 20

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º API —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏..."
echo "üìä –¢–µ—Å—Ç–∏—Ä—É–µ–º GET /api/quiz-stats..."
curl -f http://localhost:3001/api/quiz-stats && echo "‚úÖ API —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç" || echo "‚ùå API —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
echo "üìã –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏ backend..."
docker-compose -f docker-compose.yml logs backend | tail -50

echo "‚úÖ –û—Ç–ª–∞–¥–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo "üåê –¢–µ–ø–µ—Ä—å –ø—Ä–æ–π–¥–∏—Ç–µ –∫–≤–∏–∑ –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –Ω–∏–∂–µ:"
echo "üìã –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:"
docker-compose -f docker-compose.yml logs -f backend 