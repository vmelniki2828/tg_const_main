# üóÑÔ∏è –ú–∏–≥—Ä–∞—Ü–∏—è MongoDB –≤ Docker Compose

## üìã –û–±–∑–æ—Ä

MongoDB —Ç–µ–ø–µ—Ä—å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ Docker Compose –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ –∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è –±–æ—Ç–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é MongoDB
```bash
./migrate-to-local-mongo.sh
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
./check-mongo-status.sh
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### MongoDB –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- **–ü–æ—Ä—Ç:** 27017
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** tg_const_main
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** app_user
- **–ü–∞—Ä–æ–ª—å:** app_password
- **Volume:** mongodb_data (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ)

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
MONGO_URI=mongodb://app_user:app_password@mongodb:27017/tg_const_main?authSource=tg_const_main
```

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### ‚úÖ –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **–ò—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ –±–æ—Ç–æ–≤** - –¥–∞–Ω–Ω—ã–µ —Ç–µ–ø–µ—Ä—å –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
2. **–°–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã** - MongoDB –≤ —Ç–æ–π –∂–µ —Å–µ—Ç–∏ Docker
3. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤** - backend –∂–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞ MongoDB
4. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Docker volume

### üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö:
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–µ–∫—Å—ã** –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- **Health checks** –¥–ª—è MongoDB
- **Restart policy** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- **Resource limits** –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ MongoDB:
```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker compose ps mongodb

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MongoDB
docker compose exec mongodb mongosh

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π
docker compose exec mongodb mongosh tg_const_main --eval "db.bots.countDocuments()"
```

### –õ–æ–≥–∏ MongoDB:
```bash
docker compose logs mongodb
```

## üö® –í–∞–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –û–±–Ω–æ–≤–ª–µ–Ω docker-compose.yml:
- –î–æ–±–∞–≤–ª–µ–Ω —Å–µ—Ä–≤–∏—Å `mongodb`
- –û–±–Ω–æ–≤–ª–µ–Ω `MONGO_URI` –≤ backend
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `depends_on`
- –°–æ–∑–¥–∞–Ω volume `mongodb_data`

### 2. –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–¥:
- `backend/server.js` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `process.env.MONGO_URI`
- `backend/botProcess.js` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `process.env.MONGO_URI`

### 3. –°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã:
- `migrate-to-local-mongo.sh` - –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- `check-mongo-status.sh` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
- `mongo-init/init-db.js` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î

## üîÑ –û—Ç–∫–∞—Ç –Ω–∞ –≤–Ω–µ—à–Ω—é—é MongoDB

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≤–Ω–µ—à–Ω—é—é MongoDB:

1. –ò–∑–º–µ–Ω–∏—Ç–µ `MONGO_URI` –≤ docker-compose.yml:
```yaml
- MONGO_URI=mongodb://157.230.20.252:27017/tg_const_main
```

2. –£–¥–∞–ª–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç MongoDB:
```yaml
# –£–¥–∞–ª–∏—Ç–µ —Å–µ–∫—Ü–∏—é depends_on
```

3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã:
```bash
docker compose up -d
```

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### Resource limits:
- **MongoDB:** 1 CPU, 1GB RAM
- **Backend:** 2 CPU, 2GB RAM
- **Frontend:** 0.5 CPU, 512MB RAM

### Health checks:
- MongoDB –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- Backend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –≤–∞—à–∏ –±–æ—Ç—ã –±—É–¥—É—Ç:
- ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å** –±–µ–∑ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
- ‚úÖ **–ë—ã—Å—Ç—Ä–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è** –±–ª–∞–≥–æ–¥–∞—Ä—è –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è** –ø—Ä–∏ —Å–±–æ—è—Ö
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ** –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
